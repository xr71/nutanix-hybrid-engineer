{"status":{},"contains_secrets":true,"product_version":"3.0.0.1","spec":{"description":"","resources":{"client_attrs":{"943539f6_deployment":{"y":397.9886874212,"x":112.1511333526},"7a1406d9_deployment":{"y":536.796450612,"x":382.5968640653},"b5f8d383_deployment":{"y":859.3192455954,"x":170.0613267582}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"9a854886_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"306dde4f_runbook","main_task_local_reference":{"kind":"app_task","name":"9a854886_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"56f967a8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9254629a_runbook","main_task_local_reference":{"kind":"app_task","name":"56f967a8_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"9c14e51f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"3b8fe74c_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"c436f6b7_runbook","main_task_local_reference":{"kind":"app_task","name":"9c14e51f_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Stop"}],"name":"bd8007d0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"e30de1c4_runbook","main_task_local_reference":{"kind":"app_task","name":"bd8007d0_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"43592afb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"3b8fe74c_runbook","main_task_local_reference":{"kind":"app_task","name":"43592afb_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"MySQL_Service"}],"name":"WebServer","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"83f03ac8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c7b434ed_runbook","main_task_local_reference":{"kind":"app_task","name":"83f03ac8_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"63bc7f36_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ef822435_runbook","main_task_local_reference":{"kind":"app_task","name":"63bc7f36_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"db3900ca_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"7b234ec8_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"c7ad1103_runbook","main_task_local_reference":{"kind":"app_task","name":"db3900ca_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Stop"}],"name":"a13da285_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop haproxy\r\nsudo systemctl daemon-reload\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6d0b6d98_runbook","main_task_local_reference":{"kind":"app_task","name":"a13da285_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Restart"}],"name":"2d29da87_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl daemon-reload\r\nsudo systemctl restart haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"7b234ec8_runbook","main_task_local_reference":{"kind":"app_task","name":"2d29da87_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"WebServer"}],"name":"HAProxy","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"29b75658_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"79b7125b_runbook","main_task_local_reference":{"kind":"app_task","name":"29b75658_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"0abf28bb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b3339f84_runbook","main_task_local_reference":{"kind":"app_task","name":"0abf28bb_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"6bc81845_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"4af2e5f9_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"c09f7ab0_runbook","main_task_local_reference":{"kind":"app_task","name":"6bc81845_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Stop"}],"name":"853a7e32_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop mysqld\r\n# sudo systemctl status mysqld.service\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"69cc777a_runbook","main_task_local_reference":{"kind":"app_task","name":"853a7e32_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Restart"}],"name":"33be5356_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart mysqld\r\n# sudo systemctl status mysqld.service\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4af2e5f9_runbook","main_task_local_reference":{"kind":"app_task","name":"33be5356_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"MySQL_Service","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"WebServerAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"xxx@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4a85fe3c-d472-4d21-9cbe-b12e35a7f84d"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{teccadmin.username}@@\n    ssh-authorized-keys:\n      - @@{teccadmin.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"95cccf9b-03a0-4c00-bf48-b14a7f912cfc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"ce48725f-4a25-4d33-b73a-4037fc74499a"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"HAProxyAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"LoadBalancer-@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4a85fe3c-d472-4d21-9cbe-b12e35a7f84d"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{teccadmin.username}@@\n    ssh-authorized-keys:\n      - @@{teccadmin.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"95cccf9b-03a0-4c00-bf48-b14a7f912cfc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"ce48725f-4a25-4d33-b73a-4037fc74499a"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"MySQL","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"mysql-@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4a85fe3c-d472-4d21-9cbe-b12e35a7f84d"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{teccdba.username}@@\n    ssh-authorized-keys:\n      - @@{teccdba.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"95cccf9b-03a0-4c00-bf48-b14a7f912cfc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"ce48725f-4a25-4d33-b73a-4037fc74499a"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"teccadmin","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"Ou1M9GDnOi0X01u4i1cFMKueW6TEc8tpo5tIW\/XACh1Td3NNM7zFoou+SbTRPNXa3RFj0CJ89ONIphPubAl3z74q97sVgMje8Bw0NCL4zsKsTm1sS2scSpzu7w28JRJp8HIeavrQ0IdLWJ8uacyBZukDOrEtvL0lg0Q8Pco36NLA1M0rMscyGNhvZhbanlwnlMtK0SLdwOkXLHArVXFxkF5X67K8\/AZ52imVa5ONwhJsEE2SR9kRLHI\/7QkSnuN8pttcRKJ0jyoNaNzamAdtXrkith\/YPTavAq4Ad8xCNQl7mCIO0tF3qoXh1MB0BbtftU4\/XnnkmnhFk7muibuBpbtBRDY382e7xaZns6c+mQbgSC+rzJdJfEIRCU4gS4XQDO5pyat8CGveX6FwmlGNenqOK7LHhbWt2Spai6A6PnOLFu5DayXbDWW513VXn163XJ8pyGk17Z3urLFrlpCWepUUDzpjRshBZgDnbwuNKxCDu1dqr5EDpKnhSDNm0KxRfSopuUjoQZxqFQbpBnUG\/oPGVhqzGJso7kS3SVQ+lmuEdfML7T5OojBj322AGs0alokZ3065lHNntPHbpAr45LM3W6uo\/O9ho26YEzlPJVEslySL9s63KYpUfSQtUUODfKmQr8KQ4tx2niaS4EO5VKWESF\/V9TgAYweDsXpTXC7SLijgh6hree9e2\/8iRpPQ2BOioyxuVpS6TOp37HD+9ioW5p79fTDsAqDdqj0pBd0lS3UuWO8LnRwjs9tXOX2quUsJwdM3wXw5pGoMDJ2TokMDK6bkUrUmWauPmwI0H8cRcx7bwo\/5UZD5XPlm5R1uH4tFJfv2VoEVsGie2D3j6N7YO9WKCtGE145kfwR\/FX5Wh31j4yQ9c5hHwUvR\/WZnf1KRR9s8y2jzpSOs\/4iyxn+BNp2NY1bll9jyRLK+85AlTiIOviSTBLDI\/qSOjNPFKOYMhk1nQEBERIJDcCKE9r1\/UI1KSP2dc1Zr081nO6Jns2j9sy2G73xsfFWahAgsi446zdRpwVPF4LO9LrLN11FcL0VVlnPz4IcKE1bbNPsCy34\/bX7Z4691MfG2Jp1btRcsMqdS5S2vIVXhN\/AbFxhO1vumCjRTYo0\/FMr4RKlAu3DFNeSUhh+NRqw\/W3eP38xCt415NI0XdfXPZzOZi+eb3G0Dt7g1q6KVN\/3k6z+EJm1X1EHF3ncKe7fKuj4LVmG0l1PImd+PJ67KxzV7Kpf8cP68bzeSHeVQhu26SUnaEhNWQL+HG0CKILJV0+5I9Y6ib4Fa2Ej8YdUrXh4SCC5UxgtY7wSYxKC+4nTIZoxdKhFbSXqw5iBDPYfTr9B1vF\/3c\/QdwpJ80X6j0\/z9bwzZQyCN6nCMEYRbF1rB+Dt4sXtdeCq87oCSc1JIQek4MfiwGInDL6PfJ0hprSL0zJ7WJ5wAzUqBRcHkmtimVDFYFeZCo2A+Pvzsad4RDPNuubxE\/+CNTTaF+liPAZ\/eIU9yE6ohY\/zQ2Ub\/SbiUmUCwTUcnvxPY4+auciI3Ig\/BLnU4vlb47ISzR82yeMEHz\/bAh\/4HzVOXpCPl0\/qXV2d1lJQ3rfjqVT1mOvDc16NhiBjXfXnj6mBZMiwHgBWK+8hJ3RiXtwza2\/YzneHQTTpqyX56Sw65olJ34S50np+s0QE1Ms4WHGwq46bXUfgApmyyDN7+IEnhN8cg4URNG0ErJ\/FZWhUnoiqybieGl\/lMh6Q2SPlwVYFmNAl8vGStN5dMAlKidQnXvFRGEUx9jF5dv7b74m4oljdsVwagcf05JYM8w3fNqndyTW23FtmO8kE8Op6HmvZHaiqaxZOXUZfUQPLthg8ronAjA012ckm3ydQrCOs0RC4neSlQfeZjOWpF6n1iExBKWFDdAPBbNW3hltKeFRa7AAMboHEQFiscS+qQDUmG3O8NhxR900Na3jMAfZt5vU98qNxUJuv\/OM4P4fWgPVqniTohFbdqZDaOeYN3h1NZFDnZDGjrjM6dys1b4jXoEmnysaOAvo1jGE4q8nuH3oHdOvKRVrqadkqlxILB4tgH5J2AFtZkCunG+ZrFCvZqBOQ0jzPhQPG3DaWIIWDoWZkuTRQPpRiuvhcsX+PSonZmvTugfnvFYanE8YJFk8i6evyKzr42Ef\/KRaxY38SNeV8j9E2x2\/fJLN7S7qHNenLh6G5bmlcQ7Ulk4zq5GH7KI2L6y3kEC\/HHym0ngl6f+rB7kRNUIAu3DqoQluz9WPhWApzEI8oIZUHJ1ard3Dvsiui4f59lJj0INA0fyrNuhQcxH1u6rITB3iTVE4yOMaUVgm+N\/AGYOb7l\/vYg4I3tkBSOFJBDSOwww6T5YNYON3xBNY0hfR+a9tjQto+7QQbGNMRBrQxF2pQ4Jd\/gaBrNDJf4fDViB67N2LMWYQ+w2HC8FBkxiHAXPf6xkoM2FWTNTzk77lXh6CatPpMcyt3vw457bex93AhmEUQzLKgsNyXcu+Q5PvtAM0E7Xe8mi4GiIn\/pixy8K0UhaZ07PpixJ2NqIqYEEsneBWBg8JRfD\/FwozDOnx\/an0SgN+9efATnY\/cNDc5V\/rwwr1WTiBOsuouZAZPU4N+x57nJc13Ih3xhesbiJ4k4ZI5RPHhgz1R\/C9uQ619KMczPTnFluVs0V9VlUit7d+v8ckD\/3i6Vl2\/RvARuRdLzUNVUJyg11ii0PdrfSM+uU8Nw23GPvhhXWjKGvrzus5Ko\/\/QHPGu1PgH7A5tKhq0uxCz1oeEHXAxp4pvcwgN\/bViYvByVQOus68Zlf1equGS8VjWFuJVV3sqoJizroLxgu0DzBtYpvYFPqgo32URdk7NJeW2yHEI76uEbZeTqAmd+kIsGcZ94l9a+IEoNUWf7ZqVYRsn4rTnDbG7Qfj2k7YMiokoZZezQkmhl1uswCRlbsnB\/m3MiMbINChXKtJCxbfcJI+kDSdc1Nv31ACmID7ZLsNnDvpmrQV6i8c\/S2bFvCT+84rDweCfAC4GI1mgUJBy1hq77Y6WFqppUaT8zeDgQ1blk31A9xgIHgEtewBfQCsiHNMz01ujn27dTRSZPSK+Ennd0TRD0t7UuGeKART20HSw48rmdimQ6U+zC3d7QWzfSlti4pz83+KO3tSBXSbiYSyXLrG1lLn93C5pfS+Irmfglzvp8DJ713xSvj25ykEG2laOzKPONlqt5gXKil1kJHdlfrwVwgLGwc98+91Mx7MSl+AkGGugsnCq6gIVSqd+qQ6PUB0zRcCoTrBsq4vStFVfRBLOZw8qVCBcEaRxofdOX3lj4Ehz3WO6xIK8r054QkM6XMXDsO3PuX+0SEPBIpKUu9cxLJORiHCNZQU70+bYsH+SsyE6grAuRJjpg8pg5n9UQPNe\/iGVG7d5\/Lz1d3GQ7rADkJWD\/sLzmnV5Sslmp\/IDGz0Qamjl3aCoBnn\/Ur0BsVmR6tKttQHOgUW\/rHzLy781QL5bGnsh4w3D3GvM6hcZA7G5YtPfta3XF1PtSrfa\/iYT6xFRjRmOb2bRxJ2g=:utf-8"},"name":"teccadmin"},{"username":"teccdba","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"+2HMgGaEBOhaxlHyE89uK5E3\/35zq7QArYe8UbmBZXJuOEy0+LjVqxzQyITZu0CEPlUMdRS5Bj7RpRdq9ksDMhPje4axei+T3F1OxtnbOnv\/Y4D+sIsEYpth4HKgjpL\/Sx4lR1kejUr1DU85bp1fpArPTKOr\/wJ8SsScCT144qxerfOAR8C\/KV6Qkho2g2MNksUkSTNsE\/LgD1UnULoVVmxaJaQVockKxKkcHfp5WaWM9cI3TIV9+FB3NX50f9RbcUZFIOdnXb6VOJ+BDKync1ZIZEFziPIbYUOGMH+EEoE4dRT3+SfOj0smByIQGnBj1WRNiLe8uv18GRJnNDF4rlIFxiL49+J0+yP6HpdXittdfPfWVPOuFu0U1ovvmujSQWa6e6jlg4z8cbGVR2BrRfPEoGKifu2B7NoMXlZlw4BQ+Qj6A\/C61YrUilYEuYvsj5A0AMQp1UnlZv5Ip\/A\/NZY0rYLdcfkhTiJFkBlv9Y9fJBxJm9uwiPKPFg936Q5V\/bJNqyUi+xfxJc3vxzQEl9\/w7LVi5hozIPDbfvNeNjl4RUsLyR1Damt\/3\/\/oC4ug\/BlB0NiQ3Pk6L2Zy39eDBIzhdRickDeoFR+maY9ct+xdRUEENMnRhZQFqnsFJIFNqpouigpu3QgwNwzYwgykt9yyfr8FUrBLHG8yeoHpT77y+4AdkBiMw3WQK57QkWDRzhvzOGdkgqK4lXmT5SQA8ivVSZv+vRKMtqcla+dnjhbEEqMumT3S6DO3ao4L13s65Vbowzm8dcKG1VDxxO8Vu6mZJ5c+lvzrID4tFShA8XTWuHs9w4+Gp56+YsOcPB74XeSIRcw2TXmzz9G9Wx5CJzKOS53Pbgu3VGE+q3c76QXvLIwlqKaPHbkvKQhrHsEKYFSmeC5YPXTAJ\/PU2yf402IlkVgYUidBq2kthe9vDoDjionfOXYQtG+xgEiGiuOpfv+VQtfBPTaRxuv4mcEzCSALq1pUEKNjgtfjMG5BYqET362P1O44vAYiwXFeVlJV5ME09CKv04wCuzHgw2THzLyXk3y8+vlggXDVa1qaXK8Nu7B+33aLUTArEjw+vB0Jyz7iF+TG34Zaat4cWOIm24nsnokLKKmggVNzelEQ2BoInpSuXkxJtG0rsHeKmtLVjQWRuh72RQF8TzFSl3p4IKfSL1X+NHFgyaitT\/fnbLRTOTgmYRScSNNdJWAxpvboSqio1owJxKwYdHwJLZcu+AjguP0SDGpnjKJMGDWVg96ECEquleScaIFffuw9Ft++gWSx0Vd7pkAocHrTxCTpl1o98EKIcyaWsa21NUCI3MvFD6REXtO4FsRwlU39dLp813fE8h\/o3xKa+HowAWlDihfJd1Gu8dQarnFhLYxdF8orQ8vGyHWgaz2FUNM6h\/Bd38aE1jbdMTF7QpCVE5NCLJBoRIhqzYP0NYv9l1jYndTNlFIaI4HZ\/uFNtALGFxbRkmxtJnf6Jp+5wFQUNUohay4VB+V+vwTcnORtCGbjy6agvTKLblvyDzZjy8OYQ7skoWjxuH1iT9dvgxCAjDHQ905WRQj06Pwy0yeT2MQrF3JPeVTTwnCU24Q9XTRRCeCT17nKBkhep5e2S2hm\/Y4TyvvHSMoYcSzVu+3EGTLnCr7ZDR9XH2g0wb9ViT47chzNfcxjHJH8qm5rna922mKvyngJCqH5CfGyW5MNxDJbyYyhAI4yZY2Bjh1BtoVrlx0lGoOMvS51ukdScxw6UWQjHMhph4mHB6DUrxtoiTmqcADBbGqUIqP8wqeaV9ZJu0dcPvrL07WqVDxCqorGdFn5iwVKNQthjkOdq1uUEiFlkwo70rmmC6+D9S1fBEQ\/CR8lP3p16wvCWs1THk3v0F3lhjAVn8ELBZ4yvjqJfgXnZnCOWOTR5YgktkkK9v6JjeqhlbjA8ODYjH749+4JMRfm4zKMDy+GdDC6psm7\/XnW0yEUvlaax8mNovKGynCtNrFLooCM5pWY23nZ1BUppA1WAlFyv9UosjedggEKhmr1dGez1ThJnB2PXpNSddVC+AaAYzLHnYuDL+yUgB6C0r0eM9Ngf7iDBOxLUsXQaRryV6QLhnx+eNS3U7xxUZ6DtpVcXOp2LTRVyTFMhH6s3VnOwB\/j95fuhzE8oKOnNNb0PVtcmRoGfF45eYDbcNjus4UejxgegRzb7BDBHkCDRvZsDQaEsl3GTgPi6hjX0GRcR72IZcatxbE\/S2ioXAJYhzcVKSS3EgjBnDWeScwVpO\/BjBduYDY9+lkIWnMpqtYHnlnIDcN1ztBRjyazrG1F6QVz4MfktlWfZJAJnMBwqUfhsmK4bFKCZ7bT75uDLVWbYtsFPxeZOAJg3beOU5xfxZFAPudXfrtUBrV+Nkaz86pM6PoW+OkEXs2vbiFcwBhKmi7hFt3qM+PLGqljm+ITPlgEN5HYZ2XnsXM0qFL4Tr6ei\/oziZ+ctGYpQXvleOqLJrCS1g1lt\/Dcy2dH7yKBGtSuRaQn6OGt24NPc5jgiWRFR9FUDcr2HWJwpZRUnhFDcghQiC7Z+JHmFaLYi2cay2Hfom4p3b1\/A\/Y3dBs6\/iSonKTYIGDTc7zUAEeIC+to\/bBvh0zzXyMtaZV5a9FS71SiZ7kIGirv7bjiTod+GKQ\/C6gjRDB23\/2h1knHKZ5HwxGiJxQzTb\/lug3k5obQj6m\/1g6aEWMofGzpIUX1srPKDQ5rG8jKRfOg+GsvVIBk0c5UR+gAfcN6vPzWOTWJJW33jX50eC58TQvccnt6cyLSPJhNvJD15Wn4n4LG0GekC9\/MadmNTWsIVWfUO56Fbc9f4wUHSdfoX+bb6XQiQf3M4qpVgxr0OrPPkwgeoyAvBWiA+tojSDvyg2\/BWb\/RkxMth03XN4rWg10V0L\/W7OzpIgScA7M9Z5P\/uge8bNXhhxD6C+DD6l9jsjy0mzpekhd5K5xV2y0gv8f504W3tWIrehzyd+oIIFI\/I+z20Cnk7yTgqnBSLdUkdIp\/CI83DhDbXJiWFP0cXgnCnV5MePuwley6GwYCp\/2nlJ\/9G00fRj6UG7Gx+wLGXpF3LcslDLE7ez7ktNytUWrYTUVPIxm4Jaan17RIzqdfPkRiemq1ocPtZXz1skPSr90gw8IESFUkpkljnlHfUyFXs4SRzog6CXHr5X6dpqCSZARu55N4ceQ7ogI\/sWPS6LrgM9Gh+qOvQ+aOu\/sr\/SBR11Oy4Us47rS+V6Nxf8pKhgjISJPSWL50czRt5Hd7QtGwbWxN18zXNoRlXjV8VkInydivGe5wkj896s2gLPruPv\/SEdqWvJIX1SJi4kO5BY+SC0LXzwhrdKO\/5VEIFJlC9TRdxYuL95xrP1fTa5bQFYEpaJ77ysRhe2pIUxlhwDUH93s0GihOCBSfvw\/wteTiDpcHqhtZKiwVUeUVpjtR9zcqpgCAnmpFDVzYRW+nL+Nc1lcmiH2BzEzJmENwzG9CROoZe3ySUypkJNLTaP+SqjjJFVmLZySkQE7mUZWb\/aHtvhEI4F2SyuM=:utf-8"},"name":"teccdba"}],"package_definition_list":[{"description":"CentOS_8_Cloud","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_8_Cloud","version":"","options":{"type":"","name":"CentOS_8_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"https:\/\/cloud.centos.org\/centos\/8\/x86_64\/images\/CentOS-8-GenericCloud-8.2.2004-20200611.2.x86_64.qcow2","version":{"product_version":"8","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"WebServer"}],"name":"Package2","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_Update"},{"kind":"app_task","name":"WebServer_Install"},{"kind":"app_task","name":"WebServer_3Tier"}],"name":"d3664347_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"WebServer_Install"}},{"from_task_reference":{"kind":"app_task","name":"WebServer_Install"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"WebServer_3Tier"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ Install httpd and php...\"\r\nsudo yum install -y httpd\r\nsudo yum install -y php php-gd php-mbstring php-pdo php-mysqlnd\r\n\r\necho \"<IfModule mod_dir.c>\r\n        DirectoryIndex index.php index.html\r\n<\/IfModule>\" | sudo tee \/etc\/httpd\/conf.modules.d\/dir.conf\r\n\r\necho \"<?php\r\nphpinfo();\r\n?>\" | sudo tee \/var\/www\/html\/index.php\r\n\r\nsudo systemctl enable httpd\r\n\r\n# temporarily disable SELinux to prevent httpd to MySQL authentication issues\r\n# this is for testing only and should not be done in production environments\r\necho \"__ Temporarily disable SELinux...\"\r\nsudo setenforce 0\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_3Tier","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\nset -ex\n\nsudo touch \/var\/www\/html\/index.php\nsudo chown @@{teccadmin.username}@@:@@{teccadmin.username}@@ \/var\/www\/html\/index.php\n\ncat > \/var\/www\/html\/index.php <<- \"EOF\"\n<html>\n<head>\n  <title>@@{calm_blueprint_name}@@<\/title>\n<\/head>\n<body>\n <h1>Hostname: @@{name}@@ at @@{address}@@, replica: @@{calm_array_index}@@<\/h1>\n<?php\ntry {\n  $dbh = new PDO('mysql:host=@@{MySQL.address}@@;dbname=@@{DATABASE_NAME}@@', '@@{MYSQL_APP_USER}@@', '@@{MYSQL_PASSWORD}@@', array(\n    PDO::ATTR_PERSISTENT => true,\n    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n  ));\n\n  \/\/ ensure there is at least 1 row of data for the app to read\n  $data = $dbh->query(\"INSERT INTO @@{DATABASE_TABLE}@@ (id, time, message) VALUES (NULL, CURRENT_TIMESTAMP, '@@{calm_username}@@')\");\n\n  $data = $dbh->query('SELECT MAX(id) AS count FROM @@{DATABASE_TABLE}@@')->fetchAll(PDO::FETCH_COLUMN);\n  $count = $data[0]; \/\/print_r($data);\n  $data = $dbh->query(\"SELECT time, message FROM @@{DATABASE_TABLE}@@ WHERE id = $count\")->fetchAll(PDO::FETCH_ASSOC);\n  $time = $data[0]['time'];\n  $message = $data[0]['message'];\n\n  echo \"<p>Database records: $count<\/p>\\n\";\n  echo \"<p>Last maintainer: $message, on: $time<\/p>\\n\";\n  echo \"<h3>Web docroot: {$_SERVER[\"DOCUMENT_ROOT\"]}, file: {$_SERVER[\"SCRIPT_NAME\"]}<\/h3>\\n\";\n\n  $dbh = null;\n}\ncatch (PDOException $e) {\n  print \"Error!: \" . $e->getMessage() . \"<br\/>\";\n  print phpinfo();\n  die();\n}\n?><\/body>\n<\/html>\nEOF\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"69c5d583_runbook","main_task_local_reference":{"kind":"app_task","name":"d3664347_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Uninstall_WebServer"}],"name":"0b9d80b8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Uninstall_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo rm -rf \/var\/www\/html\/* || true\r\nsudo yum erase -y httpd php || true\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"34a7810d_runbook","main_task_local_reference":{"kind":"app_task","name":"0b9d80b8_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"HAProxy"}],"name":"HAProxy_Install","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Install"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_Update"},{"kind":"app_task","name":"HAProxy_Install"}],"name":"31a9b881_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Install"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"383b55d3_runbook","main_task_local_reference":{"kind":"app_task","name":"31a9b881_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Install"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Uninstall"}],"name":"d1e465f8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Uninstall","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y erase haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"bc155a8d_runbook","main_task_local_reference":{"kind":"app_task","name":"d1e465f8_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"MySQL_Service"}],"name":"MySQL_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MySQL_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_Update"},{"kind":"app_task","name":"MySQL_Install"}],"name":"611b2fd9_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"MySQL_Install"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\nset -ex\n\n# Assuming CentOS\/RedHat 8.2\necho \"__ Mysql installation...\"\n# https:\/\/dev.mysql.com\/doc\/refman\/8.0\/en\/linux-installation-yum-repo.html\n\nsudo yum install -y \"http:\/\/repo.mysql.com\/mysql80-community-release-el8.rpm\" &&\n  sudo yum module -y disable mysql &&\n  sudo yum install -y mysql-community-server\n\n# database must be started for SQL configuration\nsudo systemctl start mysqld\n# database should start on OS boot\nsudo systemctl enable mysqld\n# sudo systemctl status mysqld.service\n\necho \"__ Altering database root password...\"\n\nmysql --user=root --connect-expired-password \\\n  --password=\"$(sudo grep -oP 'temporary password(.*): \\K(\\S+)' \/var\/log\/mysqld.log)\" <<- EOF\n\nSET GLOBAL validate_password.policy=LOW;\nALTER user 'root'@'localhost' IDENTIFIED BY '@@{MYSQL_PASSWORD}@@';\n\nFLUSH PRIVILEGES;\nEOF\n\necho \"__ Creating database, table, and app user permissions...\"\n\nmysql --user=root --password='@@{MYSQL_PASSWORD}@@' <<- \"EOF\"\n\nCREATE DATABASE IF NOT EXISTS @@{DATABASE_NAME}@@ ;\nCREATE TABLE IF NOT EXISTS @@{DATABASE_NAME}@@.@@{DATABASE_TABLE}@@ ( \\\n  id INT NOT NULL AUTO_INCREMENT , \\\n  time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP , \\\n  message VARCHAR(80) NULL DEFAULT NULL , \\\n  PRIMARY KEY (id)) \\\n  ENGINE = InnoDB CHARSET=ascii COLLATE ascii_general_ci COMMENT = 'testing';\n\nFLUSH PRIVILEGES;\nCREATE USER '@@{MYSQL_APP_USER}@@'@'%' IDENTIFIED WITH mysql_native_password BY '@@{MYSQL_PASSWORD}@@' \\\n  REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0;\nGRANT SELECT, INSERT ON *.* TO '@@{MYSQL_APP_USER}@@'@'%';\n\nCREATE USER '@@{MYSQL_APP_USER}@@'@'localhost' IDENTIFIED WITH mysql_native_password BY '@@{MYSQL_PASSWORD}@@' \\\n  REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0;\nGRANT SELECT, INSERT ON *.* TO '@@{MYSQL_APP_USER}@@'@'localhost';\n\nFLUSH PRIVILEGES;\nEOF\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4692c9c5_runbook","main_task_local_reference":{"kind":"app_task","name":"611b2fd9_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MySQL_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Uninstall"}],"name":"927b5986_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Uninstall","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\necho \"Generic uninstall script, goodbye!\"\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4745b4fa_runbook","main_task_local_reference":{"kind":"app_task","name":"927b5986_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"7a1406d9_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"4","package_local_reference_list":[{"kind":"app_package","name":"Package2"}],"substrate_local_reference":{"kind":"app_substrate","name":"WebServerAHV"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"943539f6_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"HAProxy_Install"}],"substrate_local_reference":{"kind":"app_substrate","name":"HAProxyAHV"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"b5f8d383_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"MySQL_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"MySQL"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ScaleOut"},{"kind":"app_task","name":"HAProxy_Scale_Update"},{"kind":"app_task","name":"Restart"}],"name":"3cefc08f_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"HAProxy_Scale_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart"}},{"from_task_reference":{"kind":"app_task","name":"ScaleOut"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Scale_Update"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"7a1406d9_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleOut","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Scale_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"7b234ec8_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"c20d3b4b_runbook","main_task_local_reference":{"kind":"app_task","name":"3cefc08f_dag"},"variable_list":[]},"name":"WebScaleOut"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ScaleIn"},{"kind":"app_task","name":"HAProxy_Scale_Update"},{"kind":"app_task","name":"Restart"}],"name":"91c532f5_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ScaleIn"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Scale_Update"}},{"from_task_reference":{"kind":"app_task","name":"HAProxy_Scale_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"7a1406d9_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleIn","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Scale_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"7b234ec8_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"5d166b85_runbook","main_task_local_reference":{"kind":"app_task","name":"91c532f5_dag"},"variable_list":[]},"name":"WebScaleIn"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"DB_Backup"}],"name":"1c69a5fa_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"DB_Backup","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nmysqldump --all-databases --user=root --password='@@{MYSQL_PASSWORD}@@'\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"1ae56b6a_runbook","main_task_local_reference":{"kind":"app_task","name":"1c69a5fa_dag"},"variable_list":[]},"name":"DB_Backup"}],"name":"Small","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MYSQL_APP_USER","value":"webapp_user","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"regex":{"should_validate":true,"value":"[\\w!@#$%^&*\\\/_\\\\-]{8,20}"},"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"MYSQL_PASSWORD","value":"RkaXuKKgKTsqtEn7WGpZvULGr+Z5ULc+7vuEEJq2ipXkuU6G1HvouIL7Iz9A:utf-8","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_NAME","value":"tecc_webuser","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_TABLE","value":"tecc_dba_test","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"teccadmin"},"type":"USER"},"name":"Web-Application-3-Tier"},"api_version":"3.0","metadata":{"last_update_time":"1613020713160457","kind":"blueprint","spec_version":46,"creation_time":"1613013810486781","name":"Web-Application-3-Tier"}}