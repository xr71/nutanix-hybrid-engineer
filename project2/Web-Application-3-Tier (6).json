{"status":{},"contains_secrets":true,"product_version":"3.0.0.1","spec":{"description":"","resources":{"client_attrs":{"943539f6_deployment":{"y":397.9886874212,"x":112.1511333526},"7a1406d9_deployment":{"y":536.796450612,"x":382.5968640653},"b5f8d383_deployment":{"y":859.3192455954,"x":170.0613267582}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"9a854886_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"306dde4f_runbook","main_task_local_reference":{"kind":"app_task","name":"9a854886_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"56f967a8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9254629a_runbook","main_task_local_reference":{"kind":"app_task","name":"56f967a8_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"9c14e51f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"3b8fe74c_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"c436f6b7_runbook","main_task_local_reference":{"kind":"app_task","name":"9c14e51f_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Stop"}],"name":"bd8007d0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"e30de1c4_runbook","main_task_local_reference":{"kind":"app_task","name":"bd8007d0_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"43592afb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"3b8fe74c_runbook","main_task_local_reference":{"kind":"app_task","name":"43592afb_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"MySQL_Service"}],"name":"WebServer","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"83f03ac8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c7b434ed_runbook","main_task_local_reference":{"kind":"app_task","name":"83f03ac8_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"63bc7f36_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ef822435_runbook","main_task_local_reference":{"kind":"app_task","name":"63bc7f36_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"db3900ca_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"7b234ec8_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"c7ad1103_runbook","main_task_local_reference":{"kind":"app_task","name":"db3900ca_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Stop"}],"name":"a13da285_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop haproxy\r\nsudo systemctl daemon-reload\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6d0b6d98_runbook","main_task_local_reference":{"kind":"app_task","name":"a13da285_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Restart"}],"name":"2d29da87_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl daemon-reload\r\nsudo systemctl restart haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"7b234ec8_runbook","main_task_local_reference":{"kind":"app_task","name":"2d29da87_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"WebServer"}],"name":"HAProxy","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"29b75658_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"79b7125b_runbook","main_task_local_reference":{"kind":"app_task","name":"29b75658_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"0abf28bb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b3339f84_runbook","main_task_local_reference":{"kind":"app_task","name":"0abf28bb_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"6bc81845_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"4af2e5f9_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"c09f7ab0_runbook","main_task_local_reference":{"kind":"app_task","name":"6bc81845_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Stop"}],"name":"853a7e32_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop mysqld\r\n# sudo systemctl status mysqld.service\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"69cc777a_runbook","main_task_local_reference":{"kind":"app_task","name":"853a7e32_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Restart"}],"name":"33be5356_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart mysqld\r\n# sudo systemctl status mysqld.service\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4af2e5f9_runbook","main_task_local_reference":{"kind":"app_task","name":"33be5356_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"MySQL_Service","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"WebServerAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"xxx@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4a85fe3c-d472-4d21-9cbe-b12e35a7f84d"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{teccadmin.username}@@\n    ssh-authorized-keys:\n      - @@{teccadmin.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"95cccf9b-03a0-4c00-bf48-b14a7f912cfc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"ce48725f-4a25-4d33-b73a-4037fc74499a"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"HAProxyAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"LoadBalancer-@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4a85fe3c-d472-4d21-9cbe-b12e35a7f84d"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{teccadmin.username}@@\n    ssh-authorized-keys:\n      - @@{teccadmin.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"95cccf9b-03a0-4c00-bf48-b14a7f912cfc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"ce48725f-4a25-4d33-b73a-4037fc74499a"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"MySQL","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"mysql-@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4a85fe3c-d472-4d21-9cbe-b12e35a7f84d"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{teccdba.username}@@\n    ssh-authorized-keys:\n      - @@{teccdba.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"95cccf9b-03a0-4c00-bf48-b14a7f912cfc","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"ce48725f-4a25-4d33-b73a-4037fc74499a"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"teccadmin","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"ITDZvFNLnyT+gGxVXYqQSx+xkA\/3gdY6lqaGF5bxHTsHzht8\/8bUl+22TDgP1gjmaEmiphnlvvReDvJ7ovDEkL8mbNv0qjOyjJdKKjjAKEtP6hAGju0uQMNUA4nRA57tSOrgTaqY4e6H6qEcEK\/1mnMpBwDgisLij1lzI1uMK84Wwa5WKe38pC0qgtzJUZgPLfw0Y+OQVISx35qolHv0VvhIkZEh9POKdzrnAQxVV\/bdZlm3LJXIJDdNmQuKkRZe2YRlo7b1qbUjhOnY0ePiILxjKX9SBCzBR7YynybV7A5XyRG0XJPVdkIzlYWltcku7dWV7pjJdmCWC4JTRmgakUiu1hIktY37mQqcR0yzIWw3hgyPwV3CYrx+wcW7FDcKwXOJo2Qz1EHh86vKJ9+0PMMmmJzNEyBp2kdsi05cKI29v8ScJNM5WMNrmDLKYuhIKa5\/ACkHRs9FCYPrZ\/IrHirjgeHOPEszYgUZLAXLsLVPGeJuZUShCHTFMH7MzCJugg6YhnX9lQ40u93AFybfSHZN+hm8UiiqT\/wH8ggRRPg7E0BZFgQH9zV9htOHOvdd2MYoVxLf7v6luoRza+iAdJXjcfTMIrH6JcVnlcPsyOuuNwksroQLT5orDclDSg+O8ZpBU2J0zvsRlmzZpjqvsXb7033YyzXVyZ8JkM2lbmpnmyA0A8EfKZQfh37tFxE9DmsIx2NVL1jsbMegmiaIMw0hqBOJ08RJb7CMaNJiAPW3ubGe4\/hQH2Yyeiwsu1tgxmYF7WJBocNXGLmWjVpkV4CkhrqyrJOV4rEopbKH5rikbIMHkYT2xKmhV\/s\/mF2lJQnNmIIJTbE2fkLv3zNd10kOHIwQUDl9T+Ub4XTC0dmndd7ebsxy+vdou7ydbPQo\/5Itv\/brG9Z0TYkOCgOaNMFY43Pk35L0KXLVlFwQ5GFJ2WyDVpXQMjAaKOz1FC2k1lQ450uS\/wPAI5T5kskOTbR\/mhSFGg5Ci\/johEdlsQ8XslX1RuJ51X5GVs7O6r2PmYQ+KoqfTNJy9aiax5x0a9t\/0zNDmCsVCqittZaeWDfLfIuOXBjN0WCfEsRAPTrcwshfRiEISUM5PKirSsl\/oQNGVwSl34M\/0qm2gwnZHF\/rxVLWb5rvKj7nV6YTgLaPeVNw78RCvblCYtuifdwGKi7F+ZAfYLZNDYflZIEDgK9ACjMr+w3E5sDHZ\/2YzOYE18Mme1FWt7Yr6jW9XzLdsurzsyU+Bmtazyl1lFVU1Xza4fj3trg+Qp\/ivAB9TxuwwuxhJL0lupC0TTvOw6vr\/dTGTHqR9gtPdK\/CdhhaMziCiShfnpTS\/m0gaDNXe00eh56tgCvcTsyKSngbhkpdI4rV\/krqFSAJufRT16oaKW4nTwUiRVBTEUow\/6y5zw9dk3+UPVy1j+v8zC2F\/o9QPIrNTIOiCPApazeCMJpjDOcSKC+eLeKOXilGYGzrXVGvTWcMia6+SzpYDEk2w3nPqbzMsvz0rmla89zg3HGrtYRNT7sTBiqHhWMcAtjuSfffS7VOdns6E6T3Xk5\/tOxJ+EeeHNzlJpJ\/BV+OVUssHy6rljLeVNxfjkwvj7inLL0bw+Ytk7WUDDRojbBHs9K5SvTds4O\/fqSl2LX4lIJsRPJ0c0eYUF6ycLEk8Mqd+i3gE6sxmOP\/4xgMTtAQiAqstf+iNIs4MfM3iPoU4kGhc47tejbY9xlKSmSzkSJfeh23pPPlxUT+MlNYo\/sPZ8c\/H9JE\/ZJN2isjZZLVnjMOn+713Ziwj0pN\/6Y1X0mnteGKHr6\/8nmfqBx8zCIPdFK7qAL8xlFx7XmVo0aA7scoSmCfJmmdXnJhQZn8RojhNtyeB8b2d1fl5OrPNfaz316++fesHc8uikwZiDX+Vf+adCmPP3M9OVy6XU4yhQo45uVwhuwiwseoqX4sbtQykKe35Uv5YH+z+96iF3Evsrj706bRv08rnq0L0+LITnYr+u6HB+SZQ+PceDthhILTmFp+FfwNmNgr0ourhnwApkfp894FGjlBmEXMrYzfM1vvRfiPBEvm7mi82WL1qFF9Wo9ZCnoRkvnyaUPLVINVrgDwbDHoXWAli8Dlj1w9C8D1xLJ14vH33xxGF+ZETd1MBt7gcYE6uY826M\/nGvKwbhjl8+wjaivOQSbFTVv6emXvhqWACa7BOPSvvS+RryINDTiF\/DcMOekOe5et4v44qSUsMEOT0w5AK+\/9iIo4Ojnxo9jEP0wWD8qsV0sZyjPLchSOJmHs0wDc+JYaN5KfFALbRiI9gNm0Ii8wo0r4210Hc6E0cV32Dri4KId7szNF42wMk7v2acsQQffAax\/l5Irkv6YcclVKogGCG87TnSLUe6UspiZgmJADIWunRT+lO6iOy4jrUjhBqU9KsimpTRWY5CzKLT\/tVx7ibVWFZqKknpnMrpbV7jDQJJH6U8CXRbZCQhhzqN7CeIInVU3KINwQMXp9J1o9Lc9PURIUVayk5IjNmuY9Ky5qm37LvtQXTEU1I2LFyGj2Z5M2MY2C2V8mxJpqdmHmeRu3bZIKscGZcaX9u8Q+s5S9wRlrHss8P27b8kKpXrFxlePE8VV\/Af66wHgqYyDhW02G+Ay5Zp2ARxPt6GEbH9cwXC4vYPRLg0VVlmJ0B+H8YN5b3awRG4b4HGFp9AHDzRwvMwJE1SlXpV6qmHZpEa55F6WJk+fOqFYQo8fHK+Y2wRli8vI2K\/9QrPljWeiAirBURSbT6m4nXQ6Htpw19pn9Tcotq8myG0G2xj4UO9G2X10LfyV7z\/pJC2t8hB02+GkAWVn6ZxxmSzNUTSYPzBtnm6VnaCq+7OTJrhhe6fcfEeKBgLJmBhIfCjescirpGnWGLx\/J0yKXEXfJMSWUPm3WXfrBwbCa\/wAwswh0wkRrchYfr8\/oczXmBzO7u4tdqfSFEukOgQkM2ByerZ2k6L2TMFMIi698ss0Dm9O963ROs3Z1F+Yxk2cXmonVTRFmBZ6rBoWmwkURs7Qj3opeGkQ6+IWhe6LQkun6zL4ZZsEvIl8Rt6oxngwCXxZsENQw3iQgqpMHVJbipbGqV+NNQ2NEZKVfzEgMTTsnD20VppIQA4ke1ER6NhiyJDFEsN79O1Rx142V+da5Uvg+4AlSYQjpWhCSSo1mY06FhraUwT0+vzetq6lddVA5Fg8qXoCsw0Er7S1N+0kc3gABWzIhXej4Inzbz3ood24Wz1uTaWlvp2syUcNleB\/ytojaIz2ECZn7NFG18xopq\/lsnH5iE0KY1O7R9YmTJcPrQIjARY2F7wS5QxjTPXMBEqSOcbPGuu+TIEqNsStrDO\/EX1Qfy2iHAKtNXmtcWbiNyRf5gnOLNBQXfXMCygzEn4pDAJl6MQ\/JlONHMG3oREO8gGSG0qvBuN9v7ixwtRhIpcHxAoBUOK5GmiURy10GJM0N1dJ1m3Rk4IZAeUjpbFk9exAzHW0QyRNcAbnnypykycIqTpSYaPTo01ssUDh2dp0YCbNq\/uV2NuD9d16gm4IJDWc=:utf-8"},"name":"teccadmin"},{"username":"teccdba","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"t6mqEmDwerE4\/M+CX2Ueo1Ws7XcNp+80eGCQdcaurBfwY0u5ujnYecWZjHLR6wKZVoF8GJ0\/cZjtv+PbbJZogVzXyr3tv4jBfMEYLE9vQzklJiydzoGqpyTgmWHDsRtaJ+zxHDlzdF7\/JycxTZnHtPhJadCIg5VW3FjbRJSz1w5v4UTTq6we3d89NW096Kp7QVIdREO5f5DMKevmxCflrqeDfkbnmVco84ikrV08S\/+gEbOFL4iCRc3VXdVglnDAp8kVZBXNnQh22hqwfTf0Qa3Tm9C1wNrdfjccj7PCVOVfOqE+da4zHk0MQhwcXN2AZnMbQLDc+LjfRw32LhUan0St3n7JOhwHsV3Xqs0OLur5t6Q+NFkSd4Z\/4ha9PJJawXsK\/mA7AGMfK0dhHgyvC\/ncq8+Mcre5JrtP\/VjHvY+BClVF414ahiTYWaFVFmZJSVdVBzCBxbZBLm+S1m8j4xm\/aY58CQl6vRzUBGWlSZDp3r2r5BtuDRk7wftaAQdUbah8BZLiq5RTNUwnX3KLuvfar\/XnZ8gR3xjMfxGmSjwQ8iOdf686SkElcoy2d4qW74HPPtwBSIUVUIbN6RFPvgB5HSvKL1VYyhwifcQnu\/4W2S8nsoQ2iyL4RT9sjdZ40iXxfkrxI0O2ec9eAS72skReaL\/X4WsEJ3qehy4IAGk2cW63wCNB51yTtY5vBHoQEuXx4GnITqJq5brg\/wL3QL5F1ZmvDixrTN71Kt645Ir9mXntRRQO1sh2kvPDrFJZhN9w3czBMwwJxiWvGqmSRmnZ8n4WmA6Z+OCebPPPlyVsCXeheSfK5iYbVAoR+LP6Ie1z0hgmSgWSNwMlmPD849KknqDs9G3UOhc4cHs2iq6+IqU0\/r0bjYy5R8+RDOzof5zyyuzKzmutxb72rPknZTGW48TPZNVr1\/Tp4LPJsfzp+sDAKzjt\/\/XKJW2Mk8UsorqO8GHn1kQXbTpHXelcKSCP53LmZamMGxergQd\/StKnjdSX8RcJo7z24UIKpMF2NYI8vxj2IOKhZm7Z1TRTiKvlldrysxRF0tZYbAB2uYsWGJxNdTKxu9Mu+Q33iCvwHfkRQMKzxEATOCz2c5mLjAC7yJZoLp5auovcI4zfcbCs\/+uP6vm79euF7MBLvrLqu707f\/iYlGh+6lzAByq3I4vt1pbbQS7KHPttY7xInz72zXSzXGtC5F8uMVbRIi9JHEr1gmGrsKQhLRQ1TYSzHsr9\/i4B2xXJ+sqES4eBDKPcX61eEuXbWEbwZgbjAmsyW3zEHvbNgaLcsIDpHlFklU3G4VluxiB1P1l1nQnMlPnCB+2fmTrLGqtksEalW20XqUKMYUv6CIKZWZ9Elt0hVJVUnQ6OD7kcBLPhta8HJ9voGLdM45T79g\/ET927KmXf1k0mY2muE2baF4t3PSe7ExBCgeBg4H\/1mVBhQ\/xCSXHayWKoK\/Ul7zeWJQ\/dxYSxr4KRMlpup07IfERfK2CpEScT5Ij+nOjXRsQ9TZzvGUYJZkM\/zfRnk\/bqvAALq08GdOyhDFSLsZOvbnFsMlg4T2Fn6Fx+DS8j6DEx+NhwAqSmdDQ4DBgL6orQYaF9ta1YvbwFDDpCuk4olDctFnY+An+4Jax5axvYKUnIq4tk4BdXhGZ78tpoOXZAkwy61ACs7ldWCWOOPTkLlBR+Zi55dRaxXsYeSPvBq1b5l3XDqxv\/mgqNAK8VVLdxVlkaKP+umwOeT9R3pnjsRrD5icykOa39fSLur1vR\/fieetMXogQQIVl0eDWeDKEOJjFch08hUNOyYhX1piX80q0QJzotBVc6Clxx2b4EM87JV3S5iWrCwh4bM9XLL5YY1n0SvdQwAtPzQnTRPfDQqM7iZTc489kx32J5YwGGw8I9K0dea+FRE3BXc7xUluGAbTa65QkK96V4Ud1ADcSWMc3Sem\/nQw0HInMhmlAM9PLpdZTKSpl9aTXkORgS+xxxmOyFzV7MoS9xi0g4xdJUU9C1mrw98FVex2eR\/hrn91LPVI8N\/ZICIH3rdEHdn5neWUIUtGTMOZ5WtndOhjguLMGCaj0nSuXVBMPaaRbrX0H+ogbe5igI4lk7gpmaMkJYrKmvectaKqNopRdVshgCpGaYUgKJW7cb66SjgHI5q1VXjTJ6kcHdvcp2CMyWrwjjyMzaj6pG0bD1\/ueetuatbD+NU40FHm89ZQuM1bBvihw51WsUaWijsPLTm\/qAjW4bWZkLHa0FczjpGVJQfUlEtpxhv9zjXJ\/qlQD4WRUrvUQBEKUFnBANTrHE3qB4t6KuaOW7QMKF+U+QM+OXby\/GUWFuQT\/FccpddOAmPjrrGC6lT4nuW0i342diimmrhQIEQUHfhj50xabHt\/OhJGrtBD6Z3d4ZoOXYqXXgrsTjhTbXmKWAO6yoQGDRym59+TZ76Ip8udgRYIzB27M7MJWHgcbdp3OJMhwM2ojSvUgoQHZLdUEVWj3LM31NVI2IM5MNlPInj7L720McEPB8W\/+\/qaHnm1rBf7tAEb324udKjn7z5c7Uqw3h1gF7OJ2lbBmqHJIhG1IlttKFD\/7ZnhO3v2lubTgYX3BoW1VKVMII25HzYr+xWqc0OXBu46cx\/\/nPPSKXv+hy4vUegkWyu1f+9e3m7RgTZwWNFz9tGJo5gcs2tD5eDY8kupehz1WtEgvZdxb5qQBbvIEoEnGLukhXhAsnoe+AauiEVFcuI1GkI5MwnXgCRcfjOx\/6S4VQ1B8K4JxgN8Nntvfzw2TeXOcVDl2zMkDXcPhMvcOWTO4clVi1b8RrVY\/Jcm8wZTnNfsrZ1RLbF3Fvn36pH4B6wMBrz1CD3ze6uKIoYR5VhMgyVN4k+wAco4n\/KKD6DZYDTyQ5fo3cIRC6cgpynN2rM880r+ciDmA9A6rsQSi2icyYj0QUD462XEnYqA\/HSdq0Ae1ON+EZvHa1WXzviCBRV3SQzmKn7qAsti4zxpvtz0dG2E+YPAQe3ZWLcyI\/K1xa5+JbefNLwtoAxaqE39AtphZeCqRAdb8pUur0mPKUt\/NoLVuQrlRnmnbslyV8Q5C\/nwPqPab94OQ\/DtvA3SVHA5tECEMLAMiFr0bB1Lt4kE0GdlXp1E9IETbuQSnh8tqmr4rArwouGxzVEx8rwd7sY1yX1Uu6VHMVyQamgedGlCMwGqyKKKGQ1L71C\/c5g3hIsj9u2MIklsPdWdgUZT31EcqX\/t97bOsQuzr\/9KHZ+MA\/5cacaZ7KcHnXI6pLcjpHB2slVXFSFwFDoBnwYzBJNC9xap67iT+nWs1UZP8pqZKXRSo9eYcOGRLwx6aqoqqFnl\/dNmfp9mVDBp8eCBoru7GYS0iU5P4tQIpetnHWrq9WfYwWMSnypRUfu24Yg71WxPOTtcOf6r6duOkX1RIDBgrCpV+M04CXaYbk4KpWp9t6lJ+i3yxqkK9x5nH+r4prfi3bUNDbWbCzzXKQUC4UzrcyzRN0rJ7LYn2jfXtIHxB+zyJI3ykDg3eEx8MD\/NpQTq0DI3E2e1GlkQg=:utf-8"},"name":"teccdba"}],"package_definition_list":[{"description":"CentOS_8_Cloud","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_8_Cloud","version":"","options":{"type":"","name":"CentOS_8_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"https:\/\/cloud.centos.org\/centos\/8\/x86_64\/images\/CentOS-8-GenericCloud-8.2.2004-20200611.2.x86_64.qcow2","version":{"product_version":"8","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"WebServer"}],"name":"Package2","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_Update"},{"kind":"app_task","name":"WebServer_Install"},{"kind":"app_task","name":"WebServer_3Tier"}],"name":"d3664347_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"WebServer_Install"}},{"from_task_reference":{"kind":"app_task","name":"WebServer_Install"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"WebServer_3Tier"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ Install httpd and php...\"\r\nsudo yum install -y httpd\r\nsudo yum install -y php php-gd php-mbstring php-pdo php-mysqlnd\r\n\r\necho \"<IfModule mod_dir.c>\r\n        DirectoryIndex index.php index.html\r\n<\/IfModule>\" | sudo tee \/etc\/httpd\/conf.modules.d\/dir.conf\r\n\r\necho \"<?php\r\nphpinfo();\r\n?>\" | sudo tee \/var\/www\/html\/index.php\r\n\r\nsudo systemctl enable httpd\r\n\r\n# temporarily disable SELinux to prevent httpd to MySQL authentication issues\r\n# this is for testing only and should not be done in production environments\r\necho \"__ Temporarily disable SELinux...\"\r\nsudo setenforce 0\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_3Tier","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\nset -ex\n\nsudo touch \/var\/www\/html\/index.php\nsudo chown @@{teccadmin.username}@@:@@{teccadmin.username}@@ \/var\/www\/html\/index.php\n\ncat > \/var\/www\/html\/index.php <<- \"EOF\"\n<html>\n<head>\n  <title>@@{calm_blueprint_name}@@<\/title>\n<\/head>\n<body>\n <h1>Hostname: @@{name}@@ at @@{address}@@, replica: @@{calm_array_index}@@<\/h1>\n<?php\ntry {\n  $dbh = new PDO('mysql:host=@@{MySQL.address}@@;dbname=@@{DATABASE_NAME}@@', '@@{MYSQL_APP_USER}@@', '@@{MYSQL_PASSWORD}@@', array(\n    PDO::ATTR_PERSISTENT => true,\n    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n  ));\n\n  \/\/ ensure there is at least 1 row of data for the app to read\n  $data = $dbh->query(\"INSERT INTO @@{DATABASE_TABLE}@@ (id, time, message) VALUES (NULL, CURRENT_TIMESTAMP, '@@{calm_username}@@')\");\n\n  $data = $dbh->query('SELECT MAX(id) AS count FROM @@{DATABASE_TABLE}@@')->fetchAll(PDO::FETCH_COLUMN);\n  $count = $data[0]; \/\/print_r($data);\n  $data = $dbh->query(\"SELECT time, message FROM @@{DATABASE_TABLE}@@ WHERE id = $count\")->fetchAll(PDO::FETCH_ASSOC);\n  $time = $data[0]['time'];\n  $message = $data[0]['message'];\n\n  echo \"<p>Database records: $count<\/p>\\n\";\n  echo \"<p>Last maintainer: $message, on: $time<\/p>\\n\";\n  echo \"<h3>Web docroot: {$_SERVER[\"DOCUMENT_ROOT\"]}, file: {$_SERVER[\"SCRIPT_NAME\"]}<\/h3>\\n\";\n\n  $dbh = null;\n}\ncatch (PDOException $e) {\n  print \"Error!: \" . $e->getMessage() . \"<br\/>\";\n  print phpinfo();\n  die();\n}\n?><\/body>\n<\/html>\nEOF\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"69c5d583_runbook","main_task_local_reference":{"kind":"app_task","name":"d3664347_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package2"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Uninstall_WebServer"}],"name":"0b9d80b8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Uninstall_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo rm -rf \/var\/www\/html\/* || true\r\nsudo yum erase -y httpd php || true\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"34a7810d_runbook","main_task_local_reference":{"kind":"app_task","name":"0b9d80b8_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"HAProxy"}],"name":"HAProxy_Install","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Install"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_Update"},{"kind":"app_task","name":"HAProxy_Install"}],"name":"31a9b881_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Install"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"383b55d3_runbook","main_task_local_reference":{"kind":"app_task","name":"31a9b881_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Install"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Uninstall"}],"name":"d1e465f8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Uninstall","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y erase haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"bc155a8d_runbook","main_task_local_reference":{"kind":"app_task","name":"d1e465f8_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"MySQL_Service"}],"name":"MySQL_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MySQL_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_Update"},{"kind":"app_task","name":"MySQL_Install"}],"name":"611b2fd9_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"MySQL_Install"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\nset -ex\n\n# Assuming CentOS\/RedHat 8.2\necho \"__ Mysql installation...\"\n# https:\/\/dev.mysql.com\/doc\/refman\/8.0\/en\/linux-installation-yum-repo.html\n\nsudo yum install -y \"http:\/\/repo.mysql.com\/mysql80-community-release-el8.rpm\" &&\n  sudo yum module -y disable mysql &&\n  sudo yum install -y mysql-community-server\n\n# database must be started for SQL configuration\nsudo systemctl start mysqld\n# database should start on OS boot\nsudo systemctl enable mysqld\n# sudo systemctl status mysqld.service\n\necho \"__ Altering database root password...\"\n\nmysql --user=root --connect-expired-password \\\n  --password=\"$(sudo grep -oP 'temporary password(.*): \\K(\\S+)' \/var\/log\/mysqld.log)\" <<- EOF\n\nSET GLOBAL validate_password.policy=LOW;\nALTER user 'root'@'localhost' IDENTIFIED BY '@@{MYSQL_PASSWORD}@@';\n\nFLUSH PRIVILEGES;\nEOF\n\necho \"__ Creating database, table, and app user permissions...\"\n\nmysql --user=root --password='@@{MYSQL_PASSWORD}@@' <<- \"EOF\"\n\nCREATE DATABASE IF NOT EXISTS @@{DATABASE_NAME}@@ ;\nCREATE TABLE IF NOT EXISTS @@{DATABASE_NAME}@@.@@{DATABASE_TABLE}@@ ( \\\n  id INT NOT NULL AUTO_INCREMENT , \\\n  time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP , \\\n  message VARCHAR(80) NULL DEFAULT NULL , \\\n  PRIMARY KEY (id)) \\\n  ENGINE = InnoDB CHARSET=ascii COLLATE ascii_general_ci COMMENT = 'testing';\n\nFLUSH PRIVILEGES;\nCREATE USER '@@{MYSQL_APP_USER}@@'@'%' IDENTIFIED WITH mysql_native_password BY '@@{MYSQL_PASSWORD}@@' \\\n  REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0;\nGRANT SELECT, INSERT ON *.* TO '@@{MYSQL_APP_USER}@@'@'%';\n\nCREATE USER '@@{MYSQL_APP_USER}@@'@'localhost' IDENTIFIED WITH mysql_native_password BY '@@{MYSQL_PASSWORD}@@' \\\n  REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0;\nGRANT SELECT, INSERT ON *.* TO '@@{MYSQL_APP_USER}@@'@'localhost';\n\nFLUSH PRIVILEGES;\nEOF\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4692c9c5_runbook","main_task_local_reference":{"kind":"app_task","name":"611b2fd9_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MySQL_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Uninstall"}],"name":"927b5986_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Uninstall","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\necho \"Generic uninstall script, goodbye!\"\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4745b4fa_runbook","main_task_local_reference":{"kind":"app_task","name":"927b5986_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"7a1406d9_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"4","package_local_reference_list":[{"kind":"app_package","name":"Package2"}],"substrate_local_reference":{"kind":"app_substrate","name":"WebServerAHV"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"943539f6_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"HAProxy_Install"}],"substrate_local_reference":{"kind":"app_substrate","name":"HAProxyAHV"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"b5f8d383_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"MySQL_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"MySQL"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ScaleOut"},{"kind":"app_task","name":"HAProxy_Scale_Update"},{"kind":"app_task","name":"Restart"}],"name":"3cefc08f_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"HAProxy_Scale_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart"}},{"from_task_reference":{"kind":"app_task","name":"ScaleOut"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Scale_Update"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"7a1406d9_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleOut","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Scale_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"7b234ec8_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"c20d3b4b_runbook","main_task_local_reference":{"kind":"app_task","name":"3cefc08f_dag"},"variable_list":[]},"name":"WebScaleOut"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ScaleIn"},{"kind":"app_task","name":"HAProxy_Scale_Update"},{"kind":"app_task","name":"Restart"}],"name":"91c532f5_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ScaleIn"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Scale_Update"}},{"from_task_reference":{"kind":"app_task","name":"HAProxy_Scale_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"7a1406d9_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleIn","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Scale_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"7b234ec8_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"5d166b85_runbook","main_task_local_reference":{"kind":"app_task","name":"91c532f5_dag"},"variable_list":[]},"name":"WebScaleIn"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"DB_Backup"}],"name":"1c69a5fa_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"DB_Backup","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nmysqldump --all-databases --user=root --password='@@{MYSQL_PASSWORD}@@'\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"1ae56b6a_runbook","main_task_local_reference":{"kind":"app_task","name":"1c69a5fa_dag"},"variable_list":[]},"name":"DB_Backup"}],"name":"Small","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MYSQL_APP_USER","value":"webapp_user","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"regex":{"should_validate":true,"value":"[\\w!@#$%^&*\\\/_\\\\-]{8,20}"},"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"MYSQL_PASSWORD","value":"goI6QvO9zWLaGteuxd9h6W615SCe93ujHsQBHUngCnAqhZzOwtr3XbgWMURq:utf-8","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_NAME","value":"tecc_webuser","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_TABLE","value":"tecc_dba_test","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"teccadmin"},"type":"USER"},"name":"Web-Application-3-Tier"},"api_version":"3.0","metadata":{"last_update_time":"1613020915062740","kind":"blueprint","spec_version":47,"creation_time":"1613013810486781","name":"Web-Application-3-Tier"}}